version: 1.0.0
pack_type: rust_audit_raqt_mission_set10
engine: raqt
response_schema: 'MANDATORY FIRST LINES (must be first two lines):

  VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

  CITATIONS=repo/path.rs:line(-line), repo/path.rs:line(-line), ...


  Policy:

  - If a claim cannot be proven from extracted evidence, set VERDICT=INDETERMINATE.

  - Prefer deterministic extraction evidence; do not speculate.

  - Do not add markdown section headers.'
defaults:
  chat_top_k: 12
  max_tokens: 2500
  temperature: 0.0
questions:
- id: R_TRAIT_1
  title: Trait Implementation Completeness
  category: architecture
  top_k: 15
  answer_mode: llm
  advice_mode: llm
  question: 'Assess trait implementation completeness using only evidence.


    Required output lines:

    RATING=COMPLETE|MOSTLY_COMPLETE|GAPS_EXIST

    DEBUG_COVERAGE=<N>/<M>

    DISPLAY_IMPL_INVENTORY=<comma-separated signatures or NONE>

    ERROR_DISPLAY_GAPS=<comma-separated type names or NONE>

    CONFIG_DEFAULT_GAPS=<comma-separated type names or NONE>


    Rules:

    - Enumerate relevant Debug/Display/Default/Serialize/Deserialize evidence.

    - Name each missing type explicitly.

    - Return plain text only.

    - Output VERDICT first and CITATIONS second, then emit each required key exactly once.

    - Use NONE for unknown/empty inventories.'
  chat:
    retry_on_schema_fail: true
    schema_retry_attempts: 1
    strict_response_template: 'VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

      CITATIONS=<path:line(-line), path:line(-line), ...>

      RATING=COMPLETE|MOSTLY_COMPLETE|GAPS_EXIST

      DEBUG_COVERAGE=<integer>/<integer>

      DISPLAY_IMPL_INVENTORY=<signature_1, signature_2, ... or NONE>

      ERROR_DISPLAY_GAPS=<TypeA, TypeB, ... or NONE>

      CONFIG_DEFAULT_GAPS=<TypeA, TypeB, ... or NONE>'
  preflight:
  - name: raqt_all_impls
    cmd:
    - defs
    - --kind
    - object
    - --limit
    - '450'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 140
      max_chars: 7000
  - name: raqt_all_structs
    cmd:
    - defs
    - --kind
    - struct
    - --limit
    - '300'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
  - name: raqt_all_enums
    cmd:
    - defs
    - --kind
    - enum
    - --limit
    - '220'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
  - name: derive_search
    engine_override: rsqt
    cmd:
    - search
    - '#[derive('
    - --limit
    - '120'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 140
      max_chars: 7000
  - name: display_impls
    engine_override: rsqt
    cmd:
    - search
    - 'impl std::fmt::Display for '
    - --limit
    - '120'
    - --format
    - json
    render: lines
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 60
  - name: default_impls
    engine_override: rsqt
    cmd:
    - search
    - 'impl Default for '
    - --limit
    - '120'
    - --format
    - json
    render: lines
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 60
  - name: debug_impls
    engine_override: rsqt
    cmd:
    - search
    - 'impl std::fmt::Debug for '
    - --limit
    - '120'
    - --format
    - json
    render: lines
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 60
  expected_verdict: TRUE_POSITIVE
- id: R_MISSION_CALLGRAPH_1
  title: Callgraph and Coupling Hotspots
  category: architecture
  top_k: 12
  answer_mode: llm
  advice_mode: llm
  question: 'Build a coupling map for refactor planning using callgraph and refs evidence.


    Required output lines:

    EDGE_ROWS=<integer or INSUFFICIENT>

    SELF_EDGES_PRESENT=YES|NO|UNKNOWN

    TOP_CALLERS=<comma-separated symbol/path items or NONE>

    TOP_CALLEES=<comma-separated symbol/path items or NONE>

    REFACTOR_BOUNDARY_CANDIDATES=<comma-separated module/path items or NONE>


    Rules:

    - Prefer non-test production paths.

    - Cite each top caller/callee claim.

    - Return plain text only.

    - Output VERDICT first and CITATIONS second, then emit each required key exactly once.'
  chat:
    retry_on_schema_fail: true
    schema_retry_attempts: 2
    strict_response_template: 'VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

      CITATIONS=<comma-separated evidence tokens from CITE= lines only>

      EDGE_ROWS=<integer or INSUFFICIENT>

      SELF_EDGES_PRESENT=YES|NO|UNKNOWN

      TOP_CALLERS=<comma-separated symbol/path items or NONE>

      TOP_CALLEES=<comma-separated symbol/path items or NONE>

      REFACTOR_BOUNDARY_CANDIDATES=<comma-separated module/path items or NONE>'
  preflight:
  - name: mission_defs_functions
    cmd:
    - defs
    - --kind
    - function
    - --limit
    - '650'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 200
      max_chars: 9000
  - name: mission_refs_all
    cmd:
    - refs
    - --limit
    - '900'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 240
      max_chars: 9000
  - name: mission_callgraph_all
    cmd:
    - callgraph
    - --limit
    - '900'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 240
      max_chars: 9000
  - name: mission_callgraph_self
    cmd:
    - callgraph
    - --include-self
    - --limit
    - '900'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 240
      max_chars: 9000
  - name: mission_kinds_json
    cmd:
    - kinds
    - --format
    - json
  expected_verdict: TRUE_POSITIVE
- id: R_MISSION_REFACTOR_PLAN_1
  title: Mission-Grade Refactor Plan (Lunar Orbiter Constraints)
  category: planning
  top_k: 14
  answer_mode: llm
  advice_mode: llm
  question: 'Produce a refactor plan suitable for software that will run in a manned lunar orbiter.

    Assume strict reliability, observability, and fail-closed requirements.


    Required output lines:

    PLAN_READINESS=READY|NEEDS_MORE_EVIDENCE

    PHASE_1_ACTIONS=<comma-separated actions>

    PHASE_2_ACTIONS=<comma-separated actions>

    PHASE_3_ACTIONS=<comma-separated actions>

    BLOCKERS=<comma-separated blockers or NONE>

    SAFETY_GATES=<comma-separated gates>

    COVERAGE_GAPS=<comma-separated gaps or NONE>


    Rules:

    - Prioritize changes that reduce catastrophic failure risk first.

    - Avoid speculative claims not grounded in evidence.

    - Return plain text only.

    - Output VERDICT first and CITATIONS second, then emit each required key exactly once.

    - Use NONE for empty blocker/gap fields.'
  chat:
    retry_on_schema_fail: true
    schema_retry_attempts: 1
    strict_response_template: 'VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

      CITATIONS=<path:line(-line), path:line(-line), ...>

      PLAN_READINESS=READY|NEEDS_MORE_EVIDENCE

      PHASE_1_ACTIONS=<action_1, action_2, ...>

      PHASE_2_ACTIONS=<action_1, action_2, ...>

      PHASE_3_ACTIONS=<action_1, action_2, ...>

      BLOCKERS=<blocker_1, blocker_2, ... or NONE>

      SAFETY_GATES=<gate_1, gate_2, ...>

      COVERAGE_GAPS=<gap_1, gap_2, ... or NONE>'
  preflight:
  - name: plan_doctor_json
    cmd:
    - doctor
    - --format
    - json
  - name: plan_stats_json
    cmd:
    - stats
    - --format
    - json
  - name: plan_schema_json
    cmd:
    - schema
    - --format
    - json
  - name: plan_kinds_json
    cmd:
    - kinds
    - --format
    - json
  - name: plan_defs_struct_json
    cmd:
    - defs
    - --kind
    - struct
    - --limit
    - '320'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 120
      max_chars: 7000
  - name: plan_defs_function_json
    cmd:
    - defs
    - --kind
    - function
    - --limit
    - '700'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 140
      max_chars: 7000
  - name: plan_callgraph_json
    cmd:
    - callgraph
    - --limit
    - '950'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 200
      max_chars: 9000
  - name: plan_rag_search_json
    cmd:
    - rag-search
    - error handling and dependency injection
    - --top-k
    - '10'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 24
      max_chars: 8000
  - name: plan_chat_stub_json
    cmd:
    - chat
    - What are the highest risk refactor seams?
    - --backend
    - stub
    - --top-k
    - '8'
    - --prompt-profile
    - grounded
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 24
      max_chars: 8000
  expected_verdict: TRUE_POSITIVE
validation:
  required_verdicts:
  - TRUE_POSITIVE
  - FALSE_POSITIVE
  - INDETERMINATE
  citation_format: path:line(-line)
  fail_on_missing_citations: true
  enforce_citations_from_evidence: true
  enforce_no_new_paths: true
  enforce_paths_must_be_cited: true
  minimum_questions: 3
runner:
  plugin: rsqt_guru
  plugin_config:
    rules_path: cfg_rust_audit_raqt_mission_finding_rules.yaml
    question_validators_path: cfg_rust_audit_raqt_mission_question_validators.yaml
