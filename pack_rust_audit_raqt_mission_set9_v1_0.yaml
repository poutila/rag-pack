version: 1.0.0
pack_type: rust_audit_raqt_mission_set9
engine: raqt
response_schema: 'MANDATORY FIRST LINES (must be first two lines):

  VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

  CITATIONS=repo/path.rs:line(-line), repo/path.rs:line(-line), ...


  Policy:

  - If a claim cannot be proven from extracted evidence, set VERDICT=INDETERMINATE.

  - Prefer deterministic extraction evidence; do not speculate.

  - Do not add markdown section headers.'
defaults:
  chat_top_k: 12
  max_tokens: 2500
  temperature: 0.0
questions:
- id: R_PORTS_1
  title: Dependency Injection Port Coverage
  category: architecture
  top_k: 15
  answer_mode: llm
  advice_mode: llm
  question: 'Assess dependency-injection port coverage using only evidence.


    Required output lines:

    RATING=FULLY_TESTABLE|MOSTLY_TESTABLE|GAPS_EXIST


    For each production trait, enumerate:

    - trait declaration

    - impl entries

    - REAL/FAKE/TEST classification

    - counts per trait

    - Arc<T> blanket status if present'
  chat:
    retry_on_schema_fail: true
    schema_retry_attempts: 2
    strict_response_template: 'VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

      CITATIONS=<comma-separated evidence tokens from CITE= lines only>

      RATING=FULLY_TESTABLE|MOSTLY_TESTABLE|GAPS_EXIST

      PORT_TRAIT_1=<trait name @ path:line | CLASS=PRODUCTION_PORT or NONE>

      PORT_TRAIT_2=<trait name @ path:line | CLASS=PRODUCTION_PORT or NONE>

      TRAIT_IMPL_1=<trait name | CLASS=REAL|FAKE|TEST | path:line or NONE>

      TRAIT_IMPL_2=<trait name | CLASS=REAL|FAKE|TEST | path:line or NONE>

      COVERAGE_GAPS=<comma-separated gaps or NONE>'
  preflight:
  - name: raqt_traits
    cmd:
    - defs
    - --kind
    - interface
    - --limit
    - '120'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
  - name: raqt_trait_impls
    cmd:
    - defs
    - --kind
    - object
    - --limit
    - '300'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
  - name: trait_search
    engine_override: rsqt
    cmd:
    - search
    - 'pub trait '
    - --limit
    - '60'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
  - name: dyn_usage
    engine_override: rsqt
    cmd:
    - search
    - 'Box<dyn '
    - --limit
    - '60'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
  expected_verdict: TRUE_POSITIVE
- id: R_MISSION_SAFETY_1
  title: Safety and Supply-Chain Exposure Surface
  category: safety
  top_k: 12
  answer_mode: llm
  advice_mode: llm
  question: 'Build a safety exposure inventory focused on panic/unwrap/unsafe/ffi/build tooling risks.


    Required output lines:

    UNSAFE_SURFACE=NONE|LOW|MEDIUM|HIGH|INSUFFICIENT

    FFI_SURFACE=NONE|LOW|MEDIUM|HIGH|INSUFFICIENT

    PROD_PANIC_SURFACE=NONE|LOW|MEDIUM|HIGH|INSUFFICIENT

    PROD_UNWRAP_SURFACE=NONE|LOW|MEDIUM|HIGH|INSUFFICIENT

    SUPPLY_CHAIN_RISK=LOW|MEDIUM|HIGH|INSUFFICIENT

    SAFETY_GATE_1=...

    SAFETY_GATE_2=...'
  chat:
    retry_on_schema_fail: true
    schema_retry_attempts: 2
    strict_response_template: 'VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

      CITATIONS=<comma-separated evidence tokens from CITE= lines only>

      UNSAFE_SURFACE=NONE|LOW|MEDIUM|HIGH|INSUFFICIENT

      FFI_SURFACE=NONE|LOW|MEDIUM|HIGH|INSUFFICIENT

      PROD_PANIC_SURFACE=NONE|LOW|MEDIUM|HIGH|INSUFFICIENT

      PROD_UNWRAP_SURFACE=NONE|LOW|MEDIUM|HIGH|INSUFFICIENT

      SUPPLY_CHAIN_RISK=LOW|MEDIUM|HIGH|INSUFFICIENT

      SAFETY_GATE_1=<short gate or INSUFFICIENT>

      SAFETY_GATE_2=<short gate or INSUFFICIENT>'
  preflight:
  - name: unsafe_inventory
    engine_override: rsqt
    cmd:
    - search
    - unsafe
    - --limit
    - '200'
    - --format
    - json
    render: lines
    block_max_chars: 7000
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 80
  - name: ffi_inventory
    engine_override: rsqt
    cmd:
    - search
    - extern "C"
    - --limit
    - '120'
    - --format
    - json
    render: lines
    block_max_chars: 7000
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 80
  - name: prod_unwrap_inventory
    engine_override: rsqt
    cmd:
    - search
    - .unwrap(
    - --limit
    - '220'
    - --format
    - json
    render: lines
    block_max_chars: 7000
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 80
  - name: panic_inventory
    engine_override: rsqt
    cmd:
    - search
    - panic!(
    - --limit
    - '200'
    - --format
    - json
    render: lines
    block_max_chars: 7000
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 80
  - name: build_rs_inventory
    engine_override: rsqt
    cmd:
    - search
    - build.rs
    - --limit
    - '80'
    - --format
    - json
    render: lines
    block_max_chars: 5000
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      - (^|/)build\.rs$
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 40
  - name: proc_macro_inventory
    engine_override: rsqt
    cmd:
    - search
    - proc-macro = true
    - --limit
    - '80'
    - --format
    - json
    render: lines
    block_max_chars: 5000
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      - (^|/)Cargo\.toml$
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      exclude_comments: true
      max_items: 40
  expected_verdict: TRUE_POSITIVE
- id: R_MISSION_RAG_1
  title: RAG Retrieval and Chat Grounding Reliability
  category: rag
  top_k: 12
  answer_mode: llm
  advice_mode: llm
  question: 'Evaluate retrieval reliability for refactor planning.


    Required output lines:

    RAG_INDEX_EXECUTED=YES|NO|INSUFFICIENT

    RAG_SEARCH_RESULT_COUNT=<integer or INSUFFICIENT>

    CHAT_STUB_EXECUTED=YES|NO|INSUFFICIENT

    PROMPT_PROFILE_GROUNDED_SUPPORTED=YES|NO|INSUFFICIENT

    TOP_REFACTOR_SEAMS=<comma-separated seam candidates or NONE>


    Rules:

    - Use only evidence from rag-index/rag-search/chat outputs.

    - Cite seam candidates with path:line tokens.

    - Return plain text only.

    - Output VERDICT first and CITATIONS second, then emit each required key exactly once.'
  chat:
    retry_on_schema_fail: true
    schema_retry_attempts: 2
    strict_response_template: 'VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

      CITATIONS=<comma-separated evidence tokens from CITE= lines only>

      RAG_INDEX_EXECUTED=YES|NO|INSUFFICIENT

      RAG_SEARCH_RESULT_COUNT=<integer or INSUFFICIENT>

      CHAT_STUB_EXECUTED=YES|NO|INSUFFICIENT

      PROMPT_PROFILE_GROUNDED_SUPPORTED=YES|NO|INSUFFICIENT

      TOP_REFACTOR_SEAMS=<comma-separated seam candidates or NONE>'
  preflight:
  - name: rag_index_help
    cmd:
    - rag-index
    - --help
    render: lines
    block_max_chars: 6000
  - name: rag_index_build
    cmd:
    - rag-index
    - '{parquet}'
    - --output
    - '{index}'
    - --chunk-strategy
    - defs-with-refs
    - --include-refs
    render: lines
    block_max_chars: 6000
  - name: rag_search_mission_json
    cmd:
    - rag-search
    - error boundary conversion
    - --top-k
    - '8'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 20
      max_chars: 7000
  - name: rag_search_mission_text
    cmd:
    - rag-search
    - trait implementation completeness
    - --top-k
    - '5'
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 12
      max_chars: 5000
  - name: chat_help
    cmd:
    - chat
    - --help
    render: lines
    block_max_chars: 7000
  - name: chat_stub_json
    cmd:
    - chat
    - List likely refactor seams for safety-critical Rust code
    - --backend
    - stub
    - --top-k
    - '6'
    - --prompt-profile
    - grounded
    - --format
    - json
    transform:
      include_path_regex:
      - (^|/)crates/
      - (^|/)src/
      exclude_path_regex:
      - (^|/)audit_runs(/|$)
      exclude_test_files: true
      max_items: 20
      max_chars: 7000
  expected_verdict: TRUE_POSITIVE
validation:
  required_verdicts:
  - TRUE_POSITIVE
  - FALSE_POSITIVE
  - INDETERMINATE
  citation_format: path:line(-line)
  fail_on_missing_citations: true
  enforce_citations_from_evidence: true
  enforce_no_new_paths: true
  enforce_paths_must_be_cited: true
  minimum_questions: 3
runner:
  plugin: rsqt_guru
  plugin_config:
    rules_path: cfg_rust_audit_raqt_mission_finding_rules.yaml
    question_validators_path: cfg_rust_audit_raqt_mission_question_validators.yaml
