version: 1.11.0
pack_type: rust_audit_general_set1
engine: rsqt
response_schema: '--- REQUIRED OUTPUT FORMAT ---

  MANDATORY FIRST LINES (must be the first two lines of your response; copy exactly):

  VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

  CITATIONS=path:line(-line), path:line(-line), ...


  After those two lines, write the answer body.


  Hard bans:

  - Do NOT output Markdown section headers like "Analysis:" or "CITATIONS:".

  - Do NOT invent line numbers or file paths. Only cite tokens that appear in the evidence (including artifact anchors like
  *.json:1).

  - Do NOT include VERDICT or CITATIONS anywhere else in the body.


  Policy:

  - If a claim cannot be proven from extracted evidence, set VERDICT=INDETERMINATE and say "INSUFFICIENT EVIDENCE" + list
  what is missing.

  - Prefer deterministic extraction evidence; do NOT speculate.

  '
defaults:
  chat_top_k: 12
  max_tokens: 2000
  temperature: 0.0
questions:
- id: R_HEALTH_1
  title: Codebase Health Grade
  category: health
  top_k: 6
  advice_mode: llm
  question: 'RESPONSE FORMAT: You MUST start with VERDICT= and CITATIONS= as specified in the pack RESPONSE FORMAT.


    Provide an executive summary of codebase health.


    The evidence shows a composite health analysis with:

    - Overall grade (A+ to F) and score

    - Safety score (unsafe, FFI, transmute, raw pointers)

    - Reliability score (panics, unwraps, expects)

    - Coverage score (test coverage percentage)

    - API surface metrics


    Summarize the grade, highlight any areas below 80%, and provide

    1-2 actionable recommendations for improvement.

    '
  preflight:
  - name: health_summary
    cmd:
    - health
    - --format
    - json
  expected_verdict: TRUE_POSITIVE
- id: R_META_1
  title: Workspace Proof Files Present
  category: meta
  top_k: 8
  advice_mode: llm
  question: 'RESPONSE FORMAT: You MUST start with VERDICT= and CITATIONS= as specified in the pack RESPONSE FORMAT.


    Inventory proof files present in the indexed corpus.

    You MUST paste the exact file paths from evidence. Do NOT write placeholders like "(list all paths found)".


    List:

    - All Cargo.toml file paths (paste each path from evidence, e.g. crates/engine/Cargo.toml)

    - Cargo.lock path (if present in evidence)

    - rust-toolchain.toml path (if present in evidence)

    '
  preflight:
  - name: cargo_toml_files
    cmd:
    - query
    - --file
    - Cargo.toml
    - --include-all-files
    - --columns
    - file_path
    - total_lines
    - --limit
    - '20'
    - --format
    - json
  - name: cargo_lock
    cmd:
    - query
    - --file
    - Cargo.lock
    - --include-all-files
    - --columns
    - file_path
    - total_lines
    - --limit
    - '5'
    - --format
    - json
  - name: toolchain
    cmd:
    - query
    - --file
    - rust-toolchain
    - --include-all-files
    - --columns
    - file_path
    - total_lines
    - --limit
    - '5'
    - --format
    - json
  expected_verdict: TRUE_POSITIVE
- id: R_META_2
  title: Entity, Module, and Impl Distribution
  category: meta
  top_k: 6
  answer_mode: deterministic
  advice_mode: llm
  question: 'RESPONSE FORMAT: You MUST start with VERDICT= and CITATIONS= as specified in the pack RESPONSE FORMAT.


    Show the distribution of:

    1. Entity kinds (fn/struct/trait/impl/enum/macro)

    2. Module types (lib/bin/test/module)

    3. Impl blocks per file (complexity indicator)


    Identify whether this looks like a library crate, binary crate, or workspace.

    Note files with high impl counts as potential complexity hotspots.

    '
  preflight:
  - name: entity_stats
    cmd:
    - entities
    - --stats
    - --format
    - json
  - name: module_distribution
    cmd:
    - modules
    - --format
    - json
  - name: impl_distribution
    cmd:
    - impls
    - --format
    - json
  expected_verdict: TRUE_POSITIVE
- id: R_API_1
  title: Public Surface Counts by File
  category: api_coverage
  top_k: 8
  answer_mode: deterministic
  advice_mode: llm
  question: 'RESPONSE FORMAT: You MUST start with VERDICT= and CITATIONS= as specified in the pack RESPONSE FORMAT.


    Which Rust files have the largest public API surface?


    The evidence shows files sorted by API surface size with counts:

    - pub_fn_count, pub_struct_count, pub_trait_count


    Provide top 10 file paths with their counts and summarize total API surface.

    '
  preflight:
  - name: api_surface
    cmd:
    - api-surface
    - --format
    - json
  expected_verdict: TRUE_POSITIVE
validation:
  required_verdicts:
  - TRUE_POSITIVE
  - FALSE_POSITIVE
  - INDETERMINATE
  citation_format: path:line(-line)
  fail_on_missing_citations: true
  enforce_citations_from_evidence: true
  enforce_no_new_paths: true
  enforce_paths_must_be_cited: true
  minimum_questions: 4
runner:
  plugin: rsqt_guru
  plugin_config:
    rules_path: cfg_rust_audit_rsqt_general_finding_rules.yaml
    question_validators_path: cfg_rust_audit_rsqt_general_question_validators.yaml
