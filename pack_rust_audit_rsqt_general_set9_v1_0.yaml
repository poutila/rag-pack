version: 1.11.0
pack_type: rust_audit_general_set9
engine: rsqt
response_schema: '--- REQUIRED OUTPUT FORMAT ---

  MANDATORY FIRST LINES (must be the first two lines of your response; copy exactly):

  VERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE

  CITATIONS=path:line(-line), path:line(-line), ...


  After those two lines, write the answer body.


  Hard bans:

  - Do NOT output Markdown section headers like "Analysis:" or "CITATIONS:".

  - Do NOT invent line numbers or file paths. Only cite tokens that appear in the evidence (including artifact anchors like
  *.json:1).

  - Do NOT include VERDICT or CITATIONS anywhere else in the body.


  Policy:

  - If a claim cannot be proven from extracted evidence, set VERDICT=INDETERMINATE and say "INSUFFICIENT EVIDENCE" + list
  what is missing.

  - Prefer deterministic extraction evidence; do NOT speculate.

  '
defaults:
  chat_top_k: 12
  max_tokens: 2000
  temperature: 0.0
questions:
- id: R_SAFE_3
  title: Runtime Failure Surface (Production unwrap/expect)
  category: safety
  top_k: 12
  answer_mode: deterministic
  advice_mode: llm
  question: "RESPONSE FORMAT: You MUST start with VERDICT= and CITATIONS= as specified in the pack RESPONSE FORMAT.\n\nList\
    \ production `.unwrap(` and `.expect(` call sites (not tests).\n\nVALID OUTCOMES:\n1. If unwrap_hits and expect_hits are\
    \ EMPTY after test-file filtering:\n   State: \"No production unwrap/expect detected. All unwrap/expect calls are in test\
    \ code.\"\n   This is a VALID \"clean\" outcome (not NOT FOUND).\n2. If hits exist, cite each with file:line and classify.\n\
    \nFOR EACH CALL SITE (if any):\n- Cite as file_path:line from evidence\n- Include the code snippet from evidence\n- Classify\
    \ as INVARIANT / RECOVERABLE / PANIC_OK\n\nNOTE: Empty evidence after filtering = \"no issues\" = good outcome.\n"
  preflight:
  - name: unwrap_hits
    cmd:
    - search
    - .unwrap(
    - --limit
    - '120'
    - --format
    - json
    transform:
      exclude_test_files: true
      exclude_comments: true
      require_contains: .unwrap(
      max_items: 30
      render: lines
  - name: expect_hits
    cmd:
    - search
    - .expect(
    - --limit
    - '120'
    - --format
    - json
    transform:
      exclude_test_files: true
      exclude_comments: true
      require_contains: .expect(
      max_items: 30
      render: lines
  expected_verdict: TRUE_POSITIVE
- id: R_SAFE_4
  title: Panic / TODO Surface (Production Only)
  category: safety
  top_k: 10
  answer_mode: deterministic
  advice_mode: llm
  question: 'RESPONSE FORMAT: You MUST start with VERDICT= and CITATIONS= as specified in the pack RESPONSE FORMAT.


    Identify potential intentional panics / unfinished code in PRODUCTION code (not tests):

    - panic!( calls

    - todo!( and unimplemented!( macros


    The evidence shows panic counts per file. Filter out test files and assess:

    - If only test files have panics: "No production panic risk detected."

    - If production files have panics: list them with risk assessment.

    '
  preflight:
  - name: panic_files
    cmd:
    - panics
    - --format
    - json
    transform:
      exclude_test_files: true
  - name: todo_hits
    cmd:
    - search
    - todo!(
    - --limit
    - '60'
    - --format
    - json
    transform:
      exclude_test_files: true
      max_items: 20
      render: lines
  - name: unimplemented_hits
    cmd:
    - search
    - unimplemented!(
    - --limit
    - '60'
    - --format
    - json
    transform:
      exclude_test_files: true
      max_items: 20
      render: lines
  expected_verdict: TRUE_POSITIVE
- id: R_TEST_1
  title: Test Coverage and Exposure Risk
  category: testing
  top_k: 10
  answer_mode: deterministic
  advice_mode: llm
  question: "MANDATORY FIRST LINES (write these two lines first, before any analysis; copy exactly):\nVERDICT=TRUE_POSITIVE|FALSE_POSITIVE|INDETERMINATE\n\
    CITATIONS=path:line(-line), path:line(-line), ...\n\nAnalyze test coverage and untested API exposure using ONLY the evidence.\n\
    \n1) Coverage metrics:\n   - Percentage of files that have tests\n   - Whether testing appears well-distributed (brief\
    \ justification)\n\n2) Exposure risk (untested public APIs):\n   - Top 5 untested files by public API surface / exposure\
    \ score (from evidence)\n   - Total exposure score (from evidence)\n\n3) Recommendations:\n   - Prioritize untested files\
    \ by exposure risk for test-writing recommendations (top 3).\n\nRules:\n- CITATIONS must be a single comma-separated line\
    \ (no bullets, no backticks, no annotations).\n- Prefer real file:line tokens; if only CITE= tokens exist, cite those\
    \ verbatim.\n"
  preflight:
  - name: test_coverage
    cmd:
    - test-coverage
    - --format
    - json
  - name: coverage_risk
    cmd:
    - coverage-risk
    - --format
    - json
  expected_verdict: TRUE_POSITIVE
- id: R_TEST_2
  title: Integration Test Directories
  category: testing
  top_k: 10
  answer_mode: deterministic
  advice_mode: llm
  question: 'RESPONSE FORMAT: You MUST start with VERDICT= and CITATIONS= as specified in the pack RESPONSE FORMAT.


    Identify integration test directories and files (heuristic):

    - any files under `tests/`

    - any crate-specific `crates/*/tests/`


    Provide file path list and describe test intent from nearby names.

    '
  preflight:
  - name: tests_dir_hits
    cmd:
    - search
    - /tests/
    - --limit
    - '120'
    - --format
    - json
    transform:
      render: lines
      max_items: 40
      max_chars: 24000
  - name: mod_tests_hits
    cmd:
    - search
    - mod tests
    - --limit
    - '120'
    - --format
    - json
    transform:
      render: lines
      max_items: 40
      max_chars: 24000
  expected_verdict: TRUE_POSITIVE
validation:
  required_verdicts:
  - TRUE_POSITIVE
  - FALSE_POSITIVE
  - INDETERMINATE
  citation_format: path:line(-line)
  fail_on_missing_citations: true
  enforce_citations_from_evidence: true
  enforce_no_new_paths: true
  enforce_paths_must_be_cited: true
  minimum_questions: 4
runner:
  plugin: rsqt_guru
  plugin_config:
    rules_path: cfg_rust_audit_rsqt_general_finding_rules.yaml
    question_validators_path: cfg_rust_audit_rsqt_general_question_validators.yaml
